<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 防止Android应用内截图 · Makito的笔记本</title><meta name="description" content="防止Android应用内截图 - Sumi Makito"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">MAKITO的笔记本</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/links" target="_self" class="nav-list-link">链接</a></li><li class="nav-list-item"><a href="http://weibo.com/u/2393492311" target="_blank" class="nav-list-link">微博</a></li><li class="nav-list-item"><a href="https://github.com/sumimakito" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">防止Android应用内截图</h1><div class="post-time">2015年11月23日</div><div class="post-content"><p>很多时候，用户需要在我们的应用中输入类似于身份证号、密码、银行卡号等敏感信息，此时如果在后台不怀好意的应用程序对这些敏感页面进行截图，将导致用户的个人信息泄露。<br>Android为我们提供了一种可以防止Activity被截图的方案来保护用户的隐私。<br><a id="more"></a><br>在 <code>setContentView</code> 前向窗口添加一个 <code>FLAG_SECURE</code> 的 <code>FLAG</code> 。</p>
<h3 id="0x00-代码"><a href="#0x00-代码" class="headerlink" title="0x00 代码"></a>0x00 代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">    getWindow().addFlags(WindowManager.LayoutParams.FLAG_SECURE);</span><br><span class="line">    setContentView(R.layout.main);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="0x01-实机测试"><a href="#0x01-实机测试" class="headerlink" title="0x01 实机测试"></a>0x01 实机测试</h3><p><img src="http://internal-static.keep.moe/blog.keep.moe/20151123_avoid-screenshot-in-android-app/00.00.png" alt="直接截图"><br>无法通过物理组合键截图<br><img src="http://internal-static.keep.moe/blog.keep.moe/20151123_avoid-screenshot-in-android-app/00.01.png" alt="通过ADB截图"><br><img src="http://internal-static.keep.moe/blog.keep.moe/20151123_avoid-screenshot-in-android-app/00.02.png" alt="通过Dump View Hierarchy截图"><br><img src="http://internal-static.keep.moe/blog.keep.moe/20151123_avoid-screenshot-in-android-app/00.03.png" alt="通过Dump View Hierarchy截图"><br>无法使用开发工具截图<br><img src="http://internal-static.keep.moe/blog.keep.moe/20151123_avoid-screenshot-in-android-app/00.04.png" alt="通过Shell强行截图"><br>通过Shell强行截图成功 但输出的截图文件除StatusBar含有不规则的像素外几乎为全透明</p>
<h3 id="0x02-结语"><a href="#0x02-结语" class="headerlink" title="0x02 结语"></a>0x02 结语</h3><p>Android使用 <code>FLAG_SECURE</code> 限制了SurfaceFlinger的功能，也用它将图形缓存区标记为不可截图，从而一定程度上的保证了屏幕区域的安全，正常开发的情况下推荐使用。</p>
<p>当然，如果你的用户安装了Xposed框架，别费尽心思了。Forget it~ :D</p>
</div></article></div></section><footer><div class="paginator"><a href="/2015/11/06/hexo-and-travis-ci/" class="next">下一篇</a></div><div data-thread-key="2015/11/23/avoid-screenshot-in-android-app/" data-title="防止Android应用内截图" data-url="http://blog.keep.moe/2015/11/23/avoid-screenshot-in-android-app/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"blogkeepmoe"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2014 - 2016
&nbsp;<a href="http://blog.keep.moe/">Makito的笔记本</a></p><p>使用本站文章时请遵守<a href="http://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CCBY-NC-ND 4.0</a>协议。</p></div></footer><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-73442912-1",'auto');ga('send','pageview');</script><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cdiv%20style%3D%22display%3Anone%3B%22%3E %3Cspan id='cnzz_stat_icon_1256726171'%3E%3C/span%3E %3C/div%3E %3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1256726171%26show%3Dpic2' type='text/javascript'%3E%3C/script%3E"));</script></body></html>